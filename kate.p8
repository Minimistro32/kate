pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
-- INIT
function _init()
	poke(0x5f2e,1) --persist pal swap
	pal({1,2,3,4,5,6,7,10,134,133,132,128,13,11,15,16}, 1)

	pal_swap_screen_segment()
	
	timer = 0
	x_scroll = 0

	x_pos = 64
	y_pos = 64
	facing_cam = true

	house_palettes = { --can't use 14, 12, 6, or 8
		{	--tan
			front = 15,
			side = 9
		},
		{	--brown
			front = 4,
			side = 11
		},
		{	--purple
			front = 2,
			side = 10
		},
		{	--blue
			front = 1,
			side = 13
		}
	}
	
	houses = {}
	add_houses(6)
end

function add_houses(n)
	for i=0,n-1 do
		rng = rnd(100)
		pal_i = 1
		if rng < 50 then
			pal_i = 1
		elseif rng < 80 then
			pal_i = 2
		elseif rng < 90 then
			pal_i = 3
		else
			pal_i = 4
		end
		add(houses, house_palettes[pal_i])
	end
end


-->8
--UPDATE
function _update()
	-- if timer%1 == 0 then
	-- 	x_scroll += 1
	-- end

	-- --cycles houses
	-- if x_scroll % 128 == 0 then
	-- 	for i=0,2 do
	-- 		add_houses(1) 
	-- 		deli(houses, 1)
	-- 	end
	-- end

	--input
	kate_scale = min(max(((y_pos-4)/32)^2, 0.4), 1.5) --literal magic
	speed_scale = min(((y_pos)/56)^2, 1) --literal magic (56?)
	if (btn(0)) then
		x_pos-=(1*speed_scale)
		facing_cam = false
	end
	if (btn(1)) then
		x_pos+=(1*speed_scale)
		facing_cam = true
	end
	if (btn(2)) and y_pos > 22.5 then
		y_pos-=(1*speed_scale)
		facing_cam = false
	end
	if (btn(3)) and y_pos < 64 then
		y_pos+=(1*speed_scale)
		facing_cam = true
	end
	
	timer += 1
end



-->8
--DRAW
function _draw()
	cls(3)
	rectfill(0,56,128,128,0)
	palt(0, false)
	palt(14, true)

	--sidewalk
	for i=0,4 do
		spr(128,0 + i*32 - (x_scroll % 32),56,4,4)
	end
	
	--houses
	for i, palette in pairs(houses) do
		for color_key in pairs(palette) do
			pal(house_palettes[1][color_key], palette[color_key])
		end
		
		spr(136,0 + i*32 + flr(i/4)*32 - (x_scroll % 128),0,4,4)
		
		for color_key in pairs(palette) do
			pal(house_palettes[1][color_key], house_palettes[1][color_key])
		end
	end
	
	--kate
	sspr(40 + 16 * tonum(facing_cam), 0, 8, 16, x_pos, y_pos, 8 * kate_scale, 16 * kate_scale)
	-- draw_kate_face()

	palt()
end

function draw_kate_face()
	scale = 1
	sspr(64,32,30,32,16,96,30*scale,32*scale)
end



-->8
--JUNK
function draw_pal()
	for c=0,15 do
		local x = (c%4)*32
		local y = flr(c/4)*32
		rectfill(x, y, x+31,y+31, c)
	end
end

function draw_junk()
	palt(6, true)
	spr(4,64,64,2,2)
	palt()
end

function pal_swap_screen_segment()
	--use separate palette
	poke(0x5f5f,0x10)
	pal({1,2,143,4,5,6,7,142,134,133,132,128,13,14,15,16}, 2)
	--on bottom section
	memset(0x5f7b,0xff,7)
end

__gfx__
eecccceeeecccceeeecccceeeecccceeeecceeeeeecccceeeecccceeeecccceeeeccccee00000000000000000000000000000000000000000000000000000000
eefccceeeefccceeeefccceeeefccceeecccceeeeefccceeeefccceeeeccfceeeeccfcee00000000000000000000000000000000000000000000000000000000
eeffcceeeeffcceeeeffcceeeeffcceeeffccceeeeffcceeeeffcceeeecfffeeeecfffee00000000000000000000000000000000000000000000000000000000
eeffcceeeeffcceeeeffccee1effcceeefffcceeeeffcceeeeffcceeeecfffeeeecfffee00000000000000000000000000000000000000000000000000000000
eeefcceeeeefcceefeefccee1eefcceeeeefcceeeeefcceeeeefcceeeeccfeeeeeccfeee00000000000000000000000000000000000000000000000000000000
eef1cceeeef1cceefef1ccee1ef1cceeeef1cceeeef1cceeeef1cceeeecc11eeeecc11ee00000000000000000000000000000000000000000000000000000000
eef1cceefef1cceeeff1cceeeff1cceeeef1c1eeeef1cceeeef1cceeeecc01eeeecc01ee00000000000000000000000000000000000000000000000000000000
eef1cfeeeff1cfeeee11cfeeeef1c1eeeef111eeeef1c1eeeef1c1eeeefc1feeeefc1fee00000000000000000000000000000000000000000000000000000000
eeffffeeee111feeee111feeeef111eeeef111eeeef111eeeef111eeeef11feeeef11fee00000000000000000000000000000000000000000000000000000000
ee111feeee111feeee111feeeef111eeeef111eeeef111eeeef111eeeef11feeeef11fee00000000000000000000000000000000000000000000000000000000
ee111feeee111feeee111feeee1111eeeef111eeee1111eeee1111eeee1111eeee1111ee00000000000000000000000000000000000000000000000000000000
ee1111eeee1111eeee1111eeee1111eeee1111eeee1111eeee1111eeee1111eeee1111ee00000000000000000000000000000000000000000000000000000000
ee1111eeee1111eeee1111eeee1111eeee1111eeee1111eeee1111eeee1111eeee1111ee00000000000000000000000000000000000000000000000000000000
eeeffeeeeeeffeeeeeeffeeeeeeffeeeeeeffeeeeeeffeeeeefefeeeeeeffeeeeefefeee00000000000000000000000000000000000000000000000000000000
eeeffeeeeeeffeeeeeeffeeeeeeffeeeeeeffeeeeeeffeeeeefefeeeeeeffeeeeefefeee00000000000000000000000000000000000000000000000000000000
eee00eeeeee00eeeeee00eeeeee00eeeeee00eeeeee00eeeee0e0eeeeee00eeeee0e0eee00000000000000000000000000000000000000000000000000000000
88888888888888888888888888888888888888882222222222222222000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111111115d555d11111111111cccc11111111111115d555d11111111111aaccccccccccc59aaa9aacacaaaaaaee66666666666666666666666666666666
111111111155d5dd44411111111111cccc111111111155d5dd44411111111111cccccccccaaa9599999acccccaaaaaee66666666666666666666666666666666
111111111d554f4444455111111111cccc111111111d554f4444455111111111ccccccccc95b939b444aaccccaaaaaee66666666666666666666666666666666
11111155554554ff55511151111111cccc11111155554554ff55511151111111ccccccaa5545b9ff5bbaccaacccccaee00666700777776666666666666666666
000115515d55ef7ff4506051111111cccc000115515d55ef7ff4506051111111ccccc5aaa9aa9ffff95c9caccccccaee66000077777776666662666626666666
001155515654fffffd45d011111111cccc001155515654fffffd45d011111111ccccaaac595437ff399a9ccacccccaee60000007777777766662222222226666
00005511514effffddd40551111111cccc00005511514effffddd40551111111cccc55ac5c99ffff99990b5aacccccee60707007777777766662feeeefff2666
00015510056fffff666d1001510000cccc00015510056fffff666d1001510000cccc5accca9ff3f39999ccca5accccee6000000777777776662eeeeeeefff266
00155510506fdd66665d5505510000cccc00155510506fdd66665d5505510000ccc55accac6f993939995acaaaccccee66000077777777766620ee0eeeeff266
005111110466d4d66dddd015150000cccc005111110466d4d66dddd015150000ccaacaaac9639993999990caaaccccee6677777777777776688888eeeeeef226
015511150d6eddd66d4dd001150000cccc015511150d6eddd66d4dd001150000ca5aaaca0969999f699990caa5ccccee6666777777777666684848eeeeeee262
1155551006666d6f6dddd005110000cccc1155551006666d6f6dddd005110000aa55aac00666996f399990c5aa00ccee6666707070707666688888eefffee266
15555100566666ff66d66115111000cccc15555100566666ff66d66114441000c5555a00566666ff66999ca5aca000ee6666606060606666662eeeefffffe266
1555510056ff66ff66666555551000cccc1555510056ff66ff66666555551000aa555c0c56ff66ff69666a555aacccee66666060606066666662222222222666
55555100066ff6eedd66d55555010dcccc55555100066ff6eedd66d55555010da9955c00c66ff639996695a5aaca0dee66666060606066666666262666262666
5dd55100066ff66f6666d055550100cccc5dd55100066ff66f6666d05555010099555c00c66ff66f69669a5a5acc00ee66666666666666666666666666666666
dd555515566666666666d0d5150165ccccdd555515566666666666d0d515016599555acaa96666666666909ac5cc65ee66666666666666666666666666666666
55d55d515566666d6d66d055d51566cccc55d55d515566666dee66d055d5156655955a5aaa6666996999905ad5ca66ee66666666666666666666666666666666
555505555566666e6ddd505d515166cccc555505555566666e22dd505d515166555ac55a5a96666369990c595aaa66ee66666666666666666666666666666666
51151555055d666dd46d011551555dcccc51151555055d666d226d011551555d5ca5caa5c559663999990ac55c5559ee66666666666666666666666666666666
15515555150d666d4d6d001d555d56cccc15515555150d666d2d6d001d555d56a5aca5a5aac9666949990cc955ad56ee66666666666666666666666666666666
1d5115d55550d66666d00555555556cccc1d5115d55550d66666d00555555556195aa59aaa5c9966669005a55a5556ee66666666666666666666666666666666
11155d55511555dd6d000155655d5dcccc11155d55511555dd6d000155655d5d11a55955aac5559999c00aa5655d59ee66666666666666666666666666666666
1115555515155dd55100150d655511cccc1115555515155dd55100150d65551111aa555aaaaa59995c00a5c96555ccee66666666666666666666666666666666
11050d0555515ddd5000515561d510cccc11050d0555515ddd5000515561d51011c5caca55aa59995cc05aa56a95a0ee66666666666666666666666666666666
1105050515551ddd5000555565d550cccc1105050515551ddd5000555565d55011c5cc05a555a99950c05aa565d5a0ee66666666666666666666666666666666
15151110001155d550001155d5d550cccc15151110001155d550001155d5d55015a5acc00ccaa5955cc0ac55d5d55cee66666666666666666666666666666666
105d5d100000500550000555555551cccc105d5d100000500550000555555551115d5a1c0ccc5cc55ccccaaa55a551ee66666666666666666666666666666666
110555111005051551110d55551551cccc110555111005051551110d5555155111c5a5111cc5c5a55acccd5555aa51ee66666666666666666666666666666666
11015551100051510111105ddd5155cccc11015551100051510111105ddd5155110155ac100caaacca11ac59dd5a5aee66666666666666666666666666666666
11010d5110000151011110d5055151cccc11010d5110000151011110d50551511101ca5110000caacc111cd5c55a5aee66666666666666666666666666666666
110011111100005000111155055155cccc110011111100005000111155055155110011111c00cc5cc011cc55c55ca5ee66666666666666666666666666666666
6666665666666566666665666666656600000000000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee00000000000000000000000000000000
6666665666666566666665666666656600000000000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee00000000000000000000000000000000
6666665666666566666665666666656600000000000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee00000000000000000000000000000000
6666656666666656666665666666566600000000000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee00000000000000000000000000000000
6666656666666656666665666666566600000000000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee00000000000000000000000000000000
6666656666666656666665666666566600000000000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee00000000000000000000000000000000
6666656666666656666665666666566600000000000000000000000000000000eeeeeeeeeeeeeecccceeeeeeeeeeeeee00000000000000000000000000000000
5555555555555555555555555555555500000000000000000000000000000000eeeeeeeeeeeecccccccceeeeeeeeeeee00000000000000000000000000000000
5555555555555555555555555555555500000000000000000000000000000000eeeeeeeeeecccccccccccceeeeeeeeee00000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000eeeeeeeecccccccccccccccceeeeeeee00000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000eeeeeecccccccccccccccccccceeeeee00000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000eeeeccccccccccccccc00cccccceeeee00000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000eeeeeccccccccccccffff00ccccceeee00000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000eeeee9cccccccccffffffff00cccceee00000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000eeeee999cccccffffffffffff00cccee00000000000000000000000000000000
0000088000000880000008800000088000000000000000000000000000000000eeeee9999ccfffffffffffffffff0cce00000000000000000000000000000000
0008800000088000000880000008800000000000000000000000000000000000eeeee99999fffffffffffffffffffeee00000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000eeeee99999fffffffffffffffffffeee00000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000eeeee99999fffffffffffffffffffeee00000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000eeeee99999fffccccccffffffffffeee00000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000eeeee99999fffc6666cffffffffffeee00000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000eeeee99999fffc6666cffccccffffeee00000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000eeeeee9999fffccccccffccccffffeee00000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000eeeeeee999fffffffffffccccffffeee00000000000000000000000000000000
6666666656666666656666666666566600000000000000000000000000000000eeeeeeee99fffffffffffcc8cffffeee00000000000000000000000000000000
6666666656666666656666666666566600000000000000000000000000000000eeeeeeeee9fffffffffffccccffffeee00000000000000000000000000000000
6666666656666666656666666666566600000000000000000000000000000000eeeeeeeeeefffffffffffccccffffeee00000000000000000000000000000000
6666666656666666656666666666566600000000000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee00000000000000000000000000000000
6666666566666666665666666666566600000000000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee00000000000000000000000000000000
6666666566666666665666666666566600000000000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee00000000000000000000000000000000
6666666566666666665666666666566600000000000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee00000000000000000000000000000000
6666666566666666665666666666566600000000000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee00000000000000000000000000000000
